{% extends "base/base.html" %}
{% load static %}
{% block content %}

  <h2 class="mb-4">Document Management</h2>

  <div class="d-flex justify-content-between mb-3">
    <div>
      <a href="{% url 'create_folder' %}" class="btn btn-outline-success">
        <i class="bi bi-folder-plus"></i> New Folder
      </a>
      <a href="{% url 'upload_document' %}" class="btn btn-outline-primary">
        <i class="bi bi-upload"></i> Upload Document
      </a>
    </div>

    <div>
      <a href="{% url 'hr_document_list' %}" class="btn btn-sm btn-secondary">Request Document</a>
      <a href="{% url 'hr_document_list' %}" class="btn btn-sm btn-primary">Search Documents</a>
    </div>
  </div>

  <hr>

  <h4>Folders</h4>
  {% if folders %}
    <div class="row">
      {% for folder in folders %}
        <div class="col-md-3 mb-3">
          <div class="card h-100 shadow-sm">
            <a href="{% url 'folder_detail' folder.id %}" class="card-body text-center">
              <i class="bi bi-folder" style="font-size: 2rem;"></i>
              <h5 class="card-title mt-2">{{ folder.name }}</h5>
              
            </a>
            <div class="mb-1 ml-1">
              <button type="button" class="btn btn-sm btn-outline-danger mb-1 w-100 text-start" onclick="if(confirm('Are you sure you want to delete this folder?')) {
                        document.getElementById('delete-form-{{ folder.id }}').submit();
                      }">
                <i class="bi bi-trash"></i> Delete
              </button>
              <form id="delete-form-{{ folder.id }}" action="{% url 'folder_delete' folder.id %}" method="POST"
                style="display:none;">
                {% csrf_token %}
              </form>
            </div>
            
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p>No folders found.</p>
  {% endif %}

  <hr>

  <h4>Documents (root)</h4>
  {% if documents %}
    <div class="row">
      {% for doc in documents %}
        <div class="col-md-3 mb-3">
          <div class="card h-100 shadow-sm">
            <div class="card-body">
              <i class="bi bi-file-earmark"></i>
              <h6 class="mt-2">{{ doc.title }}</h6>
              <p class="text-muted mb-2">{{ doc.file.name|slice:"15" }}...</p>

              <a href="{{ doc.file.url }}" class="btn btn-sm btn-secondary">
                View
              </a>
              <a href="{% url 'document_download' doc.id %}" class="btn btn-sm btn-primary">
                Download
              </a>
              <a href="{% url 'share_document' doc.id %}" class="btn btn-sm btn-outline-secondary">
                Share
              </a>
              <a href="{% url 'document_access_logs' doc.id %}" class="btn btn-sm btn-outline-secondary">Logs</a>
              <hr>
              
              <button type="button" class="btn btn-sm btn-danger mb-1 w-100 text-start" onclick="if(confirm('Are you sure you want to delete this document?')) {
                document.getElementById('delete-form-{{ doc.id }}').submit();
                      }">
                <i class="bi bi-trash"></i> Delete
              </button>
              <form id="delete-form-{{ doc.id }}" action="{% url 'delete_hr_document' doc.id %}" method="POST"
                style="display:none;">
                {% csrf_token %}
              </form>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p>No documents in the root folder.</p>
  {% endif %}

{% endblock %}
