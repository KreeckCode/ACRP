{% extends "base/base.html" %}
{% load static %}
{% block content %}

<!-- Heading & New Document Button -->
<div class="d-flex align-items-center justify-content-between mb-4">
  <h1 class="h3 mb-0">Document Management</h1>
  <!-- If you have a URL named 'create_hr_document' -->
  <a href="{% url 'create_hr_document' %}" class="btn btn-success">
    <i class="bi bi-upload"></i> Upload New Document
  </a>
</div>

<!-- Search & Filter Card -->
<form method="GET" class="card card-body mb-4 shadow-sm border-0">
  <div class="row g-3 align-items-center">
    <!-- Search by Title -->
    <div class="col-md-4">
      <label for="search" class="form-label mb-1"><strong>Search by Title</strong></label>
      <input type="text" name="search" class="form-control" id="search" placeholder="Type a keyword..."
        value="{{ search_query|default_if_none:'' }}">
    </div>

    <!-- Filter by Section -->
    <div class="col-md-3">
      <label for="sectionFilter" class="form-label mb-1"><strong>Filter by Section</strong></label>
      <select class="form-select" name="section" id="sectionFilter">
        <option value="">All Sections</option>
        {% for code, label in sections %}
        <option value="{{ code }}" {% if section_filter == code %}selected{% endif %}>
          {{ label }}
        </option>
        {% endfor %}
      </select>
    </div>


    <!-- Submit Button -->
    <div class="col-md-2">
      <label class="form-label mb-1 d-block">&nbsp;</label>
      <button type="submit" class="btn btn-primary w-100">
        <i class="bi bi-search"></i> Search
      </button>
    </div>
  </div>
</form>

<!-- Documents Grid -->
{% if documents %}
<div class="row">
  {% for doc in documents %}
  <div class="col-sm-6 col-md-4 col-lg-3 mb-4">
    <div class="card h-100 shadow-sm border-0">
      <div class="card-body d-flex flex-column">
        <!-- Document Title -->
        <h5 class="card-title text-truncate">{{ doc.title }}</h5>

        <!-- Section + Date -->
        <p class="text-muted small mb-1">
          Section: <strong>{{ doc.section }}</strong>
        </p>
        <p class="text-muted small mb-2">
          Uploaded on: {{ doc.date_uploaded }}
        </p>

        <!-- Action Buttons -->
        <div class="mt-auto">
          <a href="{{ doc.file.url }}" class="btn btn-sm btn-outline-primary mb-1 w-100 text-start">
            View
          </a>
          <!-- Download -->
          <a href="{% url 'document_download' doc.id %}" class="btn btn-sm btn-primary mb-1 w-100 text-start">
            <i class="bi bi-download"></i> Download
          </a>
          <!-- Edit -->
          <a href="{% url 'edit_hr_document' doc.id %}" class="btn btn-sm btn-warning mb-1 w-100 text-start">
            <i class="bi bi-pencil-square"></i> Edit
          </a>

          <button type="button" class="btn btn-sm btn-danger mb-1 w-100 text-start" onclick="if(confirm('Are you sure you want to delete this document?')) {
                    document.getElementById('delete-form-{{ doc.id }}').submit();
                  }">
            <i class="bi bi-trash"></i> Delete
          </button>
          <form id="delete-form-{{ doc.id }}" action="{% url 'delete_hr_document' doc.id %}" method="POST"
            style="display:none;">
            {% csrf_token %}
          </form>

          <!-- Share -->
          <a href="{% url 'share_document' doc.id %}" class="btn btn-sm btn-outline-secondary mb-1 w-100 text-start">
            <i class="bi bi-link-45deg"></i> Share
          </a>

          <a href="{% url 'document_access_logs' doc.id %}" class="btn btn-sm btn-outline-secondary">Logs</a>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="alert alert-info">
  No documents found.
</div>
{% endif %}

{% endblock %}