{% extends "base/enrollment_base.html" %}

{% block title %}Reports & Analytics - ACRP{% endblock %}

{% block breadcrumb %}Reports & Analytics{% endblock %}

{% block content %}
<div class="py-6">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- Page Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Reports & Analytics</h1>
                    <p class="mt-2 text-sm text-gray-600">Generate comprehensive reports and view enrollment analytics</p>
                </div>
                <div class="flex space-x-3">
                    <button onclick="scheduleReport()" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                        <i class="bi bi-calendar mr-2"></i>
                        Schedule Report
                    </button>
                    <button onclick="generateCustomReport()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
                        <i class="bi bi-plus mr-2"></i>
                        Create Custom Report
                    </button>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center">
                                <i class="bi bi-file-earmark-bar-graph text-white"></i>
                            </div>
                        </div>
                        <div class="ml-4 w-0 flex-1">
                            <dl>
                                <dt class="text-sm font-medium text-gray-500 truncate">Reports Generated</dt>
                                <dd class="text-2xl font-semibold text-gray-900">{{ reports_generated|default:47 }}</dd>
                            </dl>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-green-500 rounded-md flex items-center justify-center">
                                <i class="bi bi-download text-white"></i>
                            </div>
                        </div>
                        <div class="ml-4 w-0 flex-1">
                            <dl>
                                <dt class="text-sm font-medium text-gray-500 truncate">Downloads This Month</dt>
                                <dd class="text-2xl font-semibold text-gray-900">{{ downloads_month|default:156 }}</dd>
                            </dl>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-yellow-500 rounded-md flex items-center justify-center">
                                <i class="bi bi-clock text-white"></i>
                            </div>
                        </div>
                        <div class="ml-4 w-0 flex-1">
                            <dl>
                                <dt class="text-sm font-medium text-gray-500 truncate">Scheduled Reports</dt>
                                <dd class="text-2xl font-semibold text-gray-900">{{ scheduled_reports|default:8 }}</dd>
                            </dl>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-purple-500 rounded-md flex items-center justify-center">
                                <i class="bi bi-graph-up text-white"></i>
                            </div>
                        </div>
                        <div class="ml-4 w-0 flex-1">
                            <dl>
                                <dt class="text-sm font-medium text-gray-500 truncate">Data Points</dt>
                                <dd class="text-2xl font-semibold text-gray-900">{{ data_points|default:"2.3K" }}</dd>
                            </dl>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Report Categories -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            
            <!-- Standard Reports -->
            <div class="bg-white shadow rounded-lg">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Standard Reports</h3>
                    <p class="text-sm text-gray-500">Pre-configured reports for common use cases</p>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        
                        <!-- Application Summary Report -->
                        <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <h4 class="text-sm font-medium text-gray-900">Application Summary Report</h4>
                                    <p class="text-sm text-gray-500">Overview of all applications by council and status</p>
                                    <div class="mt-2 flex items-center space-x-4 text-xs text-gray-400">
                                        <span><i class="bi bi-file-earmark mr-1"></i>PDF, Excel</span>
                                        <span><i class="bi bi-clock mr-1"></i>~2 minutes</span>
                                        <span><i class="bi bi-download mr-1"></i>Last: 2 days ago</span>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="generateReport('application_summary')" class="px-3 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                        Generate
                                    </button>
                                    <button onclick="previewReport('application_summary')" class="px-3 py-2 text-sm border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50">
                                        Preview
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Monthly Enrollment Trends -->
                        <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <h4 class="text-sm font-medium text-gray-900">Monthly Enrollment Trends</h4>
                                    <p class="text-sm text-gray-500">Application patterns and trends over time</p>
                                    <div class="mt-2 flex items-center space-x-4 text-xs text-gray-400">
                                        <span><i class="bi bi-file-earmark mr-1"></i>PDF, Excel, CSV</span>
                                        <span><i class="bi bi-clock mr-1"></i>~3 minutes</span>
                                        <span><i class="bi bi-download mr-1"></i>Last: 1 week ago</span>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="generateReport('monthly_trends')" class="px-3 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                        Generate
                                    </button>
                                    <button onclick="previewReport('monthly_trends')" class="px-3 py-2 text-sm border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50">
                                        Preview
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Council Performance Report -->
                        <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <h4 class="text-sm font-medium text-gray-900">Council Performance Report</h4>
                                    <p class="text-sm text-gray-500">Detailed analysis by council with approval rates</p>
                                    <div class="mt-2 flex items-center space-x-4 text-xs text-gray-400">
                                        <span><i class="bi bi-file-earmark mr-1"></i>PDF, Excel</span>
                                        <span><i class="bi bi-clock mr-1"></i>~4 minutes</span>
                                        <span><i class="bi bi-download mr-1"></i>Last: 3 days ago</span>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="generateReport('council_performance')" class="px-3 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                        Generate
                                    </button>
                                    <button onclick="previewReport('council_performance')" class="px-3 py-2 text-sm border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50">
                                        Preview
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Document Compliance Report -->
                        <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <h4 class="text-sm font-medium text-gray-900">Document Compliance Report</h4>
                                    <p class="text-sm text-gray-500">Analysis of document submission and verification rates</p>
                                    <div class="mt-2 flex items-center space-x-4 text-xs text-gray-400">
                                        <span><i class="bi bi-file-earmark mr-1"></i>PDF, Excel</span>
                                        <span><i class="bi bi-clock mr-1"></i>~2 minutes</span>
                                        <span><i class="bi bi-download mr-1"></i>Last: 5 days ago</span>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="generateReport('document_compliance')" class="px-3 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                        Generate
                                    </button>
                                    <button onclick="previewReport('document_compliance')" class="px-3 py-2 text-sm border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50">
                                        Preview
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Dashboard -->
            <div class="bg-white shadow rounded-lg">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Analytics Dashboard</h3>
                    <p class="text-sm text-gray-500">Real-time insights and key metrics</p>
                </div>
                <div class="p-6">
                    
                    <!-- Approval Rate Chart -->
                    <div class="mb-6">
                        <h4 class="text-sm font-medium text-gray-900 mb-3">Approval Rate by Council</h4>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">CGMP</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-32 bg-gray-200 rounded-full h-2">
                                        <div class="bg-blue-500 h-2 rounded-full" style="width: 85%"></div>
                                    </div>
                                    <span class="text-sm font-medium text-gray-900">85%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">CPSC</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-32 bg-gray-200 rounded-full h-2">
                                        <div class="bg-green-500 h-2 rounded-full" style="width: 92%"></div>
                                    </div>
                                    <span class="text-sm font-medium text-gray-900">92%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">CMTP</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-32 bg-gray-200 rounded-full h-2">
                                        <div class="bg-cyan-500 h-2 rounded-full" style="width: 78%"></div>
                                    </div>
                                    <span class="text-sm font-medium text-gray-900">78%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Application Volume -->
                    <div class="mb-6">
                        <h4 class="text-sm font-medium text-gray-900 mb-3">Application Volume (Last 7 Days)</h4>
                        <div class="flex items-end space-x-1 h-20">
                            <div class="bg-blue-200 w-6 rounded-t" style="height: 60%"></div>
                            <div class="bg-blue-200 w-6 rounded-t" style="height: 80%"></div>
                            <div class="bg-blue-200 w-6 rounded-t" style="height: 45%"></div>
                            <div class="bg-blue-200 w-6 rounded-t" style="height: 95%"></div>
                            <div class="bg-blue-200 w-6 rounded-t" style="height: 70%"></div>
                            <div class="bg-blue-500 w-6 rounded-t" style="height: 100%"></div>
                            <div class="bg-blue-200 w-6 rounded-t" style="height: 85%"></div>
                        </div>
                        <div class="flex justify-between text-xs text-gray-400 mt-1">
                            <span>Mon</span>
                            <span>Tue</span>
                            <span>Wed</span>
                            <span>Thu</span>
                            <span>Fri</span>
                            <span>Sat</span>
                            <span>Sun</span>
                        </div>
                    </div>

                    <!-- Key Metrics -->
                    <div>
                        <h4 class="text-sm font-medium text-gray-900 mb-3">Key Metrics</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div class="text-center p-3 bg-gray-50 rounded">
                                <div class="text-lg font-bold text-gray-900">4.2</div>
                                <div class="text-gray-600">Avg. Review Days</div>
                            </div>
                            <div class="text-center p-3 bg-gray-50 rounded">
                                <div class="text-lg font-bold text-gray-900">96%</div>
                                <div class="text-gray-600">Complete Apps</div>
                            </div>
                            <div class="text-center p-3 bg-gray-50 rounded">
                                <div class="text-lg font-bold text-gray-900">2.1</div>
                                <div class="text-gray-600">Docs per App</div>
                            </div>
                            <div class="text-center p-3 bg-gray-50 rounded">
                                <div class="text-lg font-bold text-gray-900">88%</div>
                                <div class="text-gray-600">First-time Pass</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Reports & Scheduled Reports -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Recent Reports -->
            <div class="bg-white shadow rounded-lg">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-medium text-gray-900">Recent Reports</h3>
                        <a href="#" class="text-sm text-blue-600 hover:text-blue-500">View all</a>
                    </div>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        {% for report in recent_reports %}
                        <div class="flex items-center justify-between py-2">
                            <div class="flex-1">
                                <h4 class="text-sm font-medium text-gray-900">{{ report.name }}</h4>
                                <div class="flex items-center space-x-2 text-xs text-gray-500">
                                    <span>{{ report.date_generated }}</span>
                                    <span>•</span>
                                    <span>{{ report.file_size }}</span>
                                    <span>•</span>
                                    <span class="inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium {% if report.status == 'completed' %}bg-green-100 text-green-800{% else %}bg-yellow-100 text-yellow-800{% endif %}">
                                        {{ report.status|title }}
                                    </span>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                {% if report.status == 'completed' %}
                                <button onclick="downloadReport('{{ report.id }}')" class="text-blue-600 hover:text-blue-500">
                                    <i class="bi bi-download"></i>
                                </button>
                                {% endif %}
                                <button onclick="deleteReport('{{ report.id }}')" class="text-red-600 hover:text-red-500">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-6 text-gray-500">
                            <i class="bi bi-file-earmark-text text-2xl mb-2"></i>
                            <p class="text-sm">No recent reports</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Scheduled Reports -->
            <div class="bg-white shadow rounded-lg">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-medium text-gray-900">Scheduled Reports</h3>
                        <button onclick="scheduleReport()" class="text-sm text-blue-600 hover:text-blue-500">
                            <i class="bi bi-plus mr-1"></i>Add Schedule
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        {% for schedule in scheduled_reports %}
                        <div class="flex items-center justify-between py-2">
                            <div class="flex-1">
                                <h4 class="text-sm font-medium text-gray-900">{{ schedule.report_name }}</h4>
                                <div class="flex items-center space-x-2 text-xs text-gray-500">
                                    <span>{{ schedule.frequency }}</span>
                                    <span>•</span>
                                    <span>Next: {{ schedule.next_run }}</span>
                                    <span>•</span>
                                    <span class="inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium {% if schedule.active %}bg-green-100 text-green-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                                        {% if schedule.active %}Active{% else %}Paused{% endif %}
                                    </span>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="toggleSchedule('{{ schedule.id }}')" class="text-blue-600 hover:text-blue-500">
                                    <i class="bi bi-{% if schedule.active %}pause{% else %}play{% endif %}"></i>
                                </button>
                                <button onclick="editSchedule('{{ schedule.id }}')" class="text-gray-600 hover:text-gray-500">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button onclick="deleteSchedule('{{ schedule.id }}')" class="text-red-600 hover:text-red-500">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-6 text-gray-500">
                            <i class="bi bi-calendar-event text-2xl mb-2"></i>
                            <p class="text-sm">No scheduled reports</p>
                            <button onclick="scheduleReport()" class="mt-2 text-blue-600 hover:text-blue-500 text-sm">
                                Schedule your first report
                            </button>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Report Generation Modal -->
<div class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden" id="reportModal">
    <div class="relative top-20 mx-auto p-5 border w-128 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Generate Report</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Report Type</label>
                    <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                        <option>Application Summary Report</option>
                        <option>Monthly Enrollment Trends</option>
                        <option>Council Performance Report</option>
                        <option>Document Compliance Report</option>
                    </select>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Date Range</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option>Last 30 days</option>
                            <option>Last 90 days</option>
                            <option>Last 6 months</option>
                            <option>Last year</option>
                            <option>Custom range</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Format</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option>PDF</option>
                            <option>Excel (XLSX)</option>
                            <option>CSV</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Filters</label>
                    <div class="grid grid-cols-3 gap-2">
                        <label class="flex items-center">
                            <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                            <span class="ml-2 text-sm">CGMP</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                            <span class="ml-2 text-sm">CPSC</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                            <span class="ml-2 text-sm">CMTP</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 mt-6">
                <button onclick="closeReportModal()" class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-50">Cancel</button>
                <button onclick="startReportGeneration()" class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700">Generate Report</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Generate standard report
    function generateReport(reportType) {
        showAlert(`Generating ${reportType.replace('_', ' ')} report...`, 'info');
        
        // Simulate report generation
        setTimeout(() => {
            showAlert('Report generated successfully! Download will begin shortly.', 'success');
        }, 3000);
    }

    // Preview report
    function previewReport(reportType) {
        showAlert('Opening report preview...', 'info');
        // In a real app, this would open a preview modal or new tab
    }

    // Generate custom report
    function generateCustomReport() {
        document.getElementById('reportModal').classList.remove('hidden');
    }

    function closeReportModal() {
        document.getElementById('reportModal').classList.add('hidden');
    }

    function startReportGeneration() {
        closeReportModal();
        showAlert('Custom report generation started...', 'info');
        
        setTimeout(() => {
            showAlert('Custom report generated successfully!', 'success');
        }, 4000);
    }

    // Schedule report
    function scheduleReport() {
        showAlert('Opening report scheduler...', 'info');
        // In a real app, this would open a scheduling modal
    }

    // Download report
    function downloadReport(reportId) {
        showAlert('Downloading report...', 'info');
        // In a real app, this would trigger the download
    }

    // Delete report
    function deleteReport(reportId) {
        if (confirm('Are you sure you want to delete this report?')) {
            showAlert('Report deleted successfully!', 'success');
            // Remove the report from the list
        }
    }

    // Toggle schedule
    function toggleSchedule(scheduleId) {
        showAlert('Schedule updated successfully!', 'success');
        // In a real app, this would toggle the schedule status
    }

    // Edit schedule
    function editSchedule(scheduleId) {
        showAlert('Opening schedule editor...', 'info');
        // In a real app, this would open an edit modal
    }

    // Delete schedule
    function deleteSchedule(scheduleId) {
        if (confirm('Are you sure you want to delete this scheduled report?')) {
            showAlert('Scheduled report deleted successfully!', 'success');
            // Remove the schedule from the list
        }
    }

    // Auto-refresh analytics every 5 minutes
    setInterval(() => {
        if (document.visibilityState === 'visible') {
            // Update analytics data
            console.log('Refreshing analytics data...');
        }
    }, 300000);
</script>
{% endblock %}