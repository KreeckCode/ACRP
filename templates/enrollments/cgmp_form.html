<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title|default:"CGMP Registration" }} - Professional Ministry Council</title>
    
    <!-- Modern CSS Framework -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Custom Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            900: '#1e3a8a'
                        },
                        accent: {
                            50: '#f0f9ff',
                            500: '#06b6d4',
                            600: '#0891b2'
                        }
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                        'display': ['Cal Sans', 'Inter', 'system-ui', 'sans-serif']
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'pulse-subtle': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom Styles -->
    <style>
        /* Modern Glassmorphism Effects */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 25px 50px -12px rgba(0, 0, 0, 0.1),
                0 0 0 1px rgba(255, 255, 255, 0.05);
        }
        
        /* Modern Form Styling */
        .form-input {
            @apply w-full px-4 py-3 border border-gray-200 rounded-xl bg-white/50 backdrop-blur-sm
                   focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent
                   transition-all duration-200 placeholder-gray-400;
        }
        
        .form-input:focus {
            transform: translateY(-1px);
            box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.1);
        }
        
        .form-label {
            @apply block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2;
        }
        
        .form-section {
            @apply opacity-0 translate-y-4 pointer-events-none absolute inset-0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .form-section.active {
            @apply opacity-100 translate-y-0 pointer-events-auto relative;
        }
        
        /* Modern Button Styling */
        .btn-primary {
            @apply px-8 py-3 bg-gradient-to-r from-primary-600 to-primary-700 text-white
                   rounded-xl font-medium shadow-lg hover:shadow-xl transform hover:-translate-y-0.5
                   transition-all duration-200 flex items-center gap-2;
        }
        
        .btn-secondary {
            @apply px-8 py-3 bg-white border border-gray-200 text-gray-700 rounded-xl font-medium
                   shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200
                   flex items-center gap-2;
        }
        
        /* Progress Bar */
        .progress-step {
            @apply w-10 h-10 rounded-full flex items-center justify-center text-sm font-semibold
                   transition-all duration-300 relative;
        }
        
        .progress-step.completed {
            @apply bg-primary-600 text-white shadow-lg;
        }
        
        .progress-step.active {
            @apply bg-primary-100 text-primary-700 ring-4 ring-primary-200;
        }
        
        .progress-step.pending {
            @apply bg-gray-100 text-gray-400;
        }
        
        /* File Upload Area */
        .file-upload-area {
            @apply border-2 border-dashed border-gray-300 rounded-xl p-8 text-center
                   hover:border-primary-400 hover:bg-primary-50/50 transition-all duration-300
                   cursor-pointer relative overflow-hidden;
        }
        
        .file-upload-area:hover {
            transform: scale(1.02);
        }
        
        /* Error States */
        .form-input.error {
            @apply border-red-300 ring-2 ring-red-100 bg-red-50/50;
        }
        
        .error-message {
            @apply text-red-600 text-sm mt-1 flex items-center gap-1 animate-fade-in;
        }
        
        /* Success States */
        .form-input.success {
            @apply border-green-300 ring-2 ring-green-100 bg-green-50/50;
        }
        
        /* Modern Checkbox */
        .modern-checkbox {
            @apply h-5 w-5 text-primary-600 focus:ring-primary-500 border-gray-300 rounded
                   transition-all duration-200;
        }
        
        /* Background Pattern */
        .bg-pattern {
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(59, 130, 246, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(6, 182, 212, 0.05) 0%, transparent 50%);
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Loading Animation */
        .loading-spinner {
            @apply animate-spin rounded-full h-6 w-6 border-2 border-white border-t-transparent;
        }
        
        /* Modern Shadow */
        .modern-shadow {
            box-shadow: 
                0 1px 3px 0 rgba(0, 0, 0, 0.1),
                0 1px 2px 0 rgba(0, 0, 0, 0.06),
                0 0 0 1px rgba(0, 0, 0, 0.05);
        }
        
        /* Responsive Grid */
        .responsive-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        
        /* File Item */
        .file-item {
            @apply flex items-center justify-between p-4 bg-gray-50 rounded-lg border
                   hover:bg-gray-100 transition-colors duration-200;
        }
        
        /* Mobile optimizations */
        @media (max-width: 640px) {
            .glass-card {
                margin: 1rem;
                border-radius: 1rem;
            }
            
            .form-input {
                padding: 0.75rem 1rem;
            }
            
            .btn-primary, .btn-secondary {
                padding: 0.75rem 1.5rem;
                font-size: 0.875rem;
            }
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-gray-50 via-white to-primary-50 bg-pattern">
    <!-- Modern Header -->
    <header class="relative bg-white/80 backdrop-blur-md border-b border-white/20 sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-primary-600 to-accent-600 rounded-xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-church text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">{{ council_name|default:"CGMP Registration" }}</h1>
                        <p class="text-sm text-gray-600">Professional Ministry Council</p>
                    </div>
                </div>
                <div class="hidden sm:flex items-center space-x-4">
                    <span class="text-sm text-gray-500">Need help?</span>
                    <a href="#" class="text-primary-600 hover:text-primary-700 text-sm font-medium">Contact Support</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Progress Indicator -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold text-gray-900">Application Progress</h2>
                <span class="text-sm text-gray-500" id="progress-text">Step 1 of 5</span>
            </div>
            
            <!-- Modern Progress Bar -->
            <div class="flex items-center space-x-4 mb-4">
                <div class="flex-1 h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-primary-600 to-accent-600 rounded-full transition-all duration-500 ease-out" 
                         id="progress-bar" style="width: 20%"></div>
                </div>
                <span class="text-sm font-medium text-gray-600" id="progress-percentage">20%</span>
            </div>
            
            <!-- Step Indicators -->
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-8">
                    <div class="flex flex-col items-center space-y-2">
                        <div class="progress-step completed" id="step-1">
                            <i class="fas fa-user text-xs"></i>
                        </div>
                        <span class="text-xs font-medium text-gray-600">Personal</span>
                    </div>
                    <div class="flex flex-col items-center space-y-2">
                        <div class="progress-step pending" id="step-2">
                            <i class="fas fa-address-book text-xs"></i>
                        </div>
                        <span class="text-xs font-medium text-gray-600">Contact</span>
                    </div>
                    <div class="flex flex-col items-center space-y-2">
                        <div class="progress-step pending" id="step-3">
                            <i class="fas fa-graduation-cap text-xs"></i>
                        </div>
                        <span class="text-xs font-medium text-gray-600">Education</span>
                    </div>
                    <div class="flex flex-col items-center space-y-2">
                        <div class="progress-step pending" id="step-4">
                            <i class="fas fa-cross text-xs"></i>
                        </div>
                        <span class="text-xs font-medium text-gray-600">Ministry</span>
                    </div>
                    <div class="flex flex-col items-center space-y-2">
                        <div class="progress-step pending" id="step-5">
                            <i class="fas fa-file-upload text-xs"></i>
                        </div>
                        <span class="text-xs font-medium text-gray-600">Documents</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error Messages -->
        {% if messages %}
        <div class="mb-6 space-y-3">
            {% for message in messages %}
            <div class="flex items-center p-4 rounded-xl border-l-4 {% if message.tags == 'error' %}bg-red-50 border-red-400 text-red-700{% elif message.tags == 'success' %}bg-green-50 border-green-400 text-green-700{% elif message.tags == 'warning' %}bg-yellow-50 border-yellow-400 text-yellow-700{% else %}bg-blue-50 border-blue-400 text-blue-700{% endif %} animate-fade-in">
                <i class="fas {% if message.tags == 'error' %}fa-exclamation-triangle{% elif message.tags == 'success' %}fa-check-circle{% elif message.tags == 'warning' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %} mr-3"></i>
                <span>{{ message }}</span>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Main Form Card -->
        <div class="glass-card rounded-2xl overflow-hidden modern-shadow">
            <form id="cgmp-form" method="post" enctype="multipart/form-data" novalidate class="relative">
                {% csrf_token %}
                
                <!-- Section 1: Personal Information -->
                <div class="form-section active" id="section-1">
                    <div class="bg-gradient-to-r from-primary-600 to-accent-600 p-8 text-white">
                        <div class="flex items-center space-x-4">
                            <div class="w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center">
                                <i class="fas fa-user text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl font-bold">Personal Information</h2>
                                <p class="text-primary-100 mt-1">Let's start with your basic details</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-8 space-y-8">
                        <!-- Title, Gender, Initials Row -->
                        <div class="responsive-grid">
                            <div>
                                <label class="form-label">
                                    <i class="fas fa-address-card text-primary-600"></i>
                                    Title *
                                </label>
                                {{ form.title }}
                                {% if form.title.errors %}
                                    <div class="error-message">
                                        <i class="fas fa-exclamation-circle"></i>
                                        {{ form.title.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label class="form-label">
                                    <i class="fas fa-venus-mars text-primary-600"></i>
                                    Gender *
                                </label>
                                {{ form.gender }}
                                {% if form.gender.errors %}
                                    <div class="error-message">
                                        <i class="fas fa-exclamation-circle"></i>
                                        {{ form.gender.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label class="form-label">
                                    <i class="fas fa-signature text-primary-600"></i>
                                    Initials *
                                </label>
                                {{ form.initials }}
                                {% if form.initials.errors %}
                                    <div class="error-message">
                                        <i class="fas fa-exclamation-circle"></i>
                                        {{ form.initials.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Names Row -->
                        <div class="responsive-grid">
                            <div>
                                <label class="form-label">
                                    <i class="fas fa-user text-primary-600"></i>
                                    First Name *
                                </label>
                                {{ form.first_name }}
                                {% if form.first_name.errors %}
                                    <div class="error-message">
                                        <i class="fas fa-exclamation-circle"></i>
                                        {{ form.first_name.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label class="form-label">
                                    <i class="fas fa-user text-primary-600"></i>
                                    Last Name *
                                </label>
                                {{ form.last_name }}
                                {% if form.last_name.errors %}
                                    <div class="error-message">
                                        <i class="fas fa-exclamation-circle"></i>
                                        {{ form.last_name.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label class="form-label">
                                    <i class="fas fa-heart text-primary-600"></i>
                                    Preferred Name
                                </label>
                                {{ form.preferred_name }}
                                <p class="text-xs text-gray-500 mt-1">How you'd like to be addressed</p>
                            </div>
                        </div>

                        <!-- ID and Birth Info -->
                        <div class="responsive-grid">
                            <div>
                                <label class="form-label">
                                    <i class="fas fa-id-card text-primary-600"></i>
                                    ID Number *
                                </label>
                                {{ form.id_number }}
                                <p class="text-xs text-gray-500 mt-1">13-digit South African ID number</p>
                                {% if form.id_number.errors %}
                                    <div class="error-message">
                                        <i class="fas fa-exclamation-circle"></i>
                                        {{ form.id_number.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label class="form-label">
                                    <i class="fas fa-passport text-primary-600"></i>
                                    Passport Number
                                </label>
                                {{ form.passport_number }}
                                <p class="text-xs text-gray-500 mt-1">For non-SA residents only</p>
                            </div>
                            
                            <div>
                                <label class="form-label">
                                    <i class="fas fa-calendar text-primary-600"></i>
                                    Date of Birth *
                                </label>
                                {{ form.date_of_birth }}
                                {% if form.date_of_birth.errors %}
                                    <div class="error-message">
                                        <i class="fas fa-exclamation-circle"></i>
                                        {{ form.date_of_birth.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Additional Personal Info -->
                        <div class="responsive-grid">
                            <div>
                                <label class="form-label">
                                    <i class="fas fa-users text-primary-600"></i>
                                    Race *
                                </label>
                                {{ form.race }}
                                {% if form.race.errors %}
                                    <div class="error-message">
                                        <i class="fas fa-exclamation-circle"></i>
                                        {{ form.race.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label class="form-label">
                                    <i class="fas fa-universal-access text-primary-600"></i>
                                    Disability
                                </label>
                                {{ form.disability }}
                                <p class="text-xs text-gray-500 mt-1">Please specify if applicable</p>
                            </div>
                        </div>

                        <!-- Languages -->
                        <div class="responsive-grid">
                            <div>
                                <label class="form-label">
                                    <i class="fas fa-language text-primary-600"></i>
                                    Home Language
                                </label>
                                {{ form.home_language }}
                            </div>
                            
                            <div>
                                <label class="form-label">
                                    <i class="fas fa-globe text-primary-600"></i>
                                    Other Languages
                                </label>
                                {{ form.other_languages }}
                                <p class="text-xs text-gray-500 mt-1">Separate multiple languages with commas</p>
                            </div>
                        </div>

                        <!-- Religious Affiliation -->
                        <div>
                            <label class="form-label">
                                <i class="fas fa-cross text-primary-600"></i>
                                Religious Affiliation
                            </label>
                            {{ form.religious_affiliation }}
                            <p class="text-xs text-gray-500 mt-1">Your denomination or religious background</p>
                        </div>
                    </div>
                </div>

                <!-- Additional sections would follow the same pattern -->
                <!-- Section 2: Contact Information -->
                <!-- Section 3: Education & Professional -->
                <!-- Section 4: Ministry Information -->
                <!-- Section 5: Documents & Legal -->

                <!-- Navigation Footer -->
                <div class="bg-gray-50 border-t border-gray-200 p-6 flex justify-between items-center">
                    <button type="button" id="prev-btn" class="btn-secondary hidden">
                        <i class="fas fa-chevron-left"></i>
                        Previous
                    </button>
                    
                    <div class="flex space-x-4">
                        <button type="button" id="next-btn" class="btn-primary">
                            Next Step
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        
                        <button type="submit" id="submit-btn" class="btn-primary bg-gradient-to-r from-green-600 to-green-700 hidden">
                            <span class="submit-text">Submit Application</span>
                            <span class="loading-text hidden">
                                <div class="loading-spinner"></div>
                                Submitting...
                            </span>
                            <i class="fas fa-paper-plane submit-icon"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Help Section -->
        <div class="mt-8 glass-card rounded-xl p-6">
            <div class="flex items-start space-x-4">
                <div class="w-12 h-12 bg-accent-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-question-circle text-accent-600 text-xl"></i>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-900 mb-2">Need Assistance?</h3>
                    <p class="text-gray-600 text-sm mb-3">
                        Our support team is here to help you complete your application successfully.
                    </p>
                    <div class="flex flex-wrap gap-4 text-sm">
                        <a href="mailto:support@cgmp.org" class="flex items-center text-primary-600 hover:text-primary-700">
                            <i class="fas fa-envelope mr-2"></i>
                            Email Support
                        </a>
                        <a href="tel:+27123456789" class="flex items-center text-primary-600 hover:text-primary-700">
                            <i class="fas fa-phone mr-2"></i>
                            Call Us
                        </a>
                        <a href="#" class="flex items-center text-primary-600 hover:text-primary-700">
                            <i class="fas fa-file-alt mr-2"></i>
                            User Guide
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="glass-card p-8 rounded-2xl text-center max-w-sm mx-4">
            <div class="w-16 h-16 mx-auto mb-4 bg-primary-100 rounded-full flex items-center justify-center">
                <div class="loading-spinner w-8 h-8 border-primary-600"></div>
            </div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Submitting Application</h3>
            <p class="text-gray-600 text-sm">Please don't close this window while we process your application...</p>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Professional form management
        class ModernFormManager {
            constructor() {
                this.currentSection = 1;
                this.totalSections = 5;
                this.isSubmitting = false;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.updateProgress();
                this.setupValidation();
            }

            setupEventListeners() {
                document.getElementById('next-btn')?.addEventListener('click', () => this.nextSection());
                document.getElementById('prev-btn')?.addEventListener('click', () => this.prevSection());
                document.getElementById('submit-btn')?.addEventListener('click', (e) => this.handleSubmit(e));
                
                // Real-time validation
                document.querySelectorAll('input, select, textarea').forEach(field => {
                    field.addEventListener('blur', () => this.validateField(field));
                    field.addEventListener('input', () => this.clearFieldError(field));
                });
            }

            setupValidation() {
                // Add modern validation styles
                document.querySelectorAll('.form-input').forEach(input => {
                    input.addEventListener('focus', () => {
                        input.classList.add('ring-2', 'ring-primary-200');
                    });
                    
                    input.addEventListener('blur', () => {
                        input.classList.remove('ring-2', 'ring-primary-200');
                    });
                });
            }

            validateField(field) {
                const value = field.value.trim();
                let isValid = true;

                // Clear previous errors
                this.clearFieldError(field);

                // Required field validation
                if (field.required && !value) {
                    this.showFieldError(field, 'This field is required');
                    isValid = false;
                }

                // Email validation
                if (field.type === 'email' && value) {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(value)) {
                        this.showFieldError(field, 'Please enter a valid email address');
                        isValid = false;
                    }
                }

                // ID number validation
                if (field.name === 'id_number' && value) {
                    if (!/^\d{13}$/.test(value)) {
                        this.showFieldError(field, 'ID number must be exactly 13 digits');
                        isValid = false;
                    }
                }

                return isValid;
            }

            showFieldError(field, message) {
                field.classList.add('error');
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i>${message}`;
                
                field.parentElement.appendChild(errorDiv);
            }

            clearFieldError(field) {
                field.classList.remove('error');
                const errorDiv = field.parentElement.querySelector('.error-message');
                if (errorDiv) errorDiv.remove();
            }

            nextSection() {
                if (this.validateCurrentSection()) {
                    if (this.currentSection < this.totalSections) {
                        this.currentSection++;
                        this.showSection(this.currentSection);
                    }
                }
            }

            prevSection() {
                if (this.currentSection > 1) {
                    this.currentSection--;
                    this.showSection(this.currentSection);
                }
            }

            showSection(sectionNumber) {
                // Hide all sections
                document.querySelectorAll('.form-section').forEach(section => {
                    section.classList.remove('active');
                });

                // Show current section
                const currentSection = document.getElementById(`section-${sectionNumber}`);
                if (currentSection) {
                    setTimeout(() => {
                        currentSection.classList.add('active');
                    }, 150);
                }

                this.updateProgress();
                this.updateNavigation();
                
                // Smooth scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            updateProgress() {
                const percentage = (this.currentSection / this.totalSections) * 100;
                
                // Update progress bar
                const progressBar = document.getElementById('progress-bar');
                const progressText = document.getElementById('progress-text');
                const progressPercentage = document.getElementById('progress-percentage');
                
                if (progressBar) progressBar.style.width = `${percentage}%`;
                if (progressText) progressText.textContent = `Step ${this.currentSection} of ${this.totalSections}`;
                if (progressPercentage) progressPercentage.textContent = `${Math.round(percentage)}%`;

                // Update step indicators
                for (let i = 1; i <= this.totalSections; i++) {
                    const step = document.getElementById(`step-${i}`);
                    if (step) {
                        step.className = 'progress-step ';
                        if (i < this.currentSection) {
                            step.className += 'completed';
                        } else if (i === this.currentSection) {
                            step.className += 'active';
                        } else {
                            step.className += 'pending';
                        }
                    }
                }
            }

            updateNavigation() {
                const prevBtn = document.getElementById('prev-btn');
                const nextBtn = document.getElementById('next-btn');
                const submitBtn = document.getElementById('submit-btn');

                if (prevBtn) {
                    prevBtn.classList.toggle('hidden', this.currentSection === 1);
                }

                if (nextBtn && submitBtn) {
                    const isLastSection = this.currentSection === this.totalSections;
                    nextBtn.classList.toggle('hidden', isLastSection);
                    submitBtn.classList.toggle('hidden', !isLastSection);
                }
            }

            validateCurrentSection() {
                const currentSectionEl = document.getElementById(`section-${this.currentSection}`);
                const fields = currentSectionEl.querySelectorAll('input[required], select[required], textarea[required]');
                let isValid = true;

                fields.forEach(field => {
                    if (!this.validateField(field)) {
                        isValid = false;
                    }
                });

                return isValid;
            }

            handleSubmit(e) {
                e.preventDefault();
                
                if (this.isSubmitting) return;

                // Validate all sections
                let allValid = true;
                for (let i = 1; i <= this.totalSections; i++) {
                    const section = document.getElementById(`section-${i}`);
                    const fields = section.querySelectorAll('input[required], select[required], textarea[required]');
                    
                    fields.forEach(field => {
                        if (!this.validateField(field)) {
                            allValid = false;
                        }
                    });
                }

                if (!allValid) {
                    this.showNotification('Please correct all errors before submitting', 'error');
                    return;
                }

                if (confirm('Are you sure you want to submit your application? You will not be able to edit it afterwards.')) {
                    this.submitForm();
                }
            }

            submitForm() {
                this.isSubmitting = true;
                
                // Show loading state
                document.getElementById('loading-overlay').classList.remove('hidden');
                
                const submitBtn = document.getElementById('submit-btn');
                const submitText = submitBtn.querySelector('.submit-text');
                const loadingText = submitBtn.querySelector('.loading-text');
                const submitIcon = submitBtn.querySelector('.submit-icon');
                
                submitText.classList.add('hidden');
                loadingText.classList.remove('hidden');
                submitIcon.classList.add('hidden');
                submitBtn.disabled = true;

                // Submit the form
                document.getElementById('cgmp-form').submit();
            }

            showNotification(message, type = 'info') {
                // Create notification
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 max-w-sm transform translate-x-full transition-transform duration-300 ${
                    type === 'error' ? 'bg-red-500 text-white' : 
                    type === 'success' ? 'bg-green-500 text-white' : 
                    'bg-blue-500 text-white'
                }`;
                
                notification.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <i class="fas ${type === 'error' ? 'fa-exclamation-triangle' : type === 'success' ? 'fa-check-circle' : 'fa-info-circle'}"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Show notification
                setTimeout(() => {
                    notification.classList.remove('translate-x-full');
                }, 100);
                
                // Hide notification after 5 seconds
                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => notification.remove(), 300);
                }, 5000);
            }
        }

        // Initialize form manager when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new ModernFormManager();
        });
    </script>
</body>
</html>