{% extends 'base/base.html' %}
{% load static %}
{% block content %}
<div class="container py-4">

  <!-- Card Wrapper -->
  <div class="card shadow-sm">
    <div class="card-header d-flex align-items-center">
      <!-- Heading with icon -->
      <h5 class="mb-0">
        <i class="bi bi-diagram-3 me-2"></i>
        {% if project %}Edit{% else %}Create{% endif %} Project
      </h5>
    </div>

    <div class="card-body">

      <!-- Display success/error messages (optional) -->
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} my-2">{{ message }}</div>
        {% endfor %}
      {% endif %}

      <!-- Show form-wide errors, if any -->
      {% if form.errors %}
        <div class="alert alert-danger mb-3" role="alert">
          Please correct the errors below.
        </div>
      {% endif %}

      <!-- Project Form -->
      <form method="POST">
        {% csrf_token %}
        <div class="row">
          {% for field in form.visible_fields %}
            {% with widget_type=field.field.widget.input_type %}
              <div class="col-md-6 mb-3">
                <label for="{{ field.id_for_label }}" class="form-label">
                  {{ field.label }}
                </label>

                {% if widget_type == "checkbox" %}
                  <div class="form-check">
                    <input
                      type="checkbox"
                      name="{{ field.name }}"
                      id="{{ field.id_for_label }}"
                      class="form-check-input"
                      {% if field.value %}checked{% endif %}
                    >
                    <label class="form-check-label" for="{{ field.id_for_label }}">
                      {{ field.label }}
                    </label>
                  </div>

                {% elif widget_type == "select" %}
                  <select
                    name="{{ field.name }}"
                    id="{{ field.id_for_label }}"
                    class="form-control"
                    {% if field.field.widget.attrs.multiple %}multiple{% endif %}
                  >
                    {% for val, txt in field.field.choices %}
                      <option
                        value="{{ val }}"
                        {% if val == field.value %}selected{% endif %}
                      >
                        {{ txt }}
                      </option>
                    {% endfor %}
                  </select>

                {% elif widget_type == "textarea" %}
                  <textarea
                    name="{{ field.name }}"
                    id="{{ field.id_for_label }}"
                    rows="4"
                    class="form-control"
                  >{{ field.value }}</textarea>

                {% else %}
                  <!-- Default input type -->
                  <input
                    type="{{ widget_type|default_if_none:'text' }}"
                    name="{{ field.name }}"
                    id="{{ field.id_for_label }}"
                    value="{{ field.value|default_if_none:'' }}"
                    class="form-control"
                  >
                {% endif %}

                <!-- Help text -->
                {% if field.help_text %}
                  <small class="text-muted d-block">{{ field.help_text }}</small>
                {% endif %}
                <!-- Field-specific errors -->
                {% for error in field.errors %}
                  <div class="text-danger">{{ error }}</div>
                {% endfor %}
              </div>
            {% endwith %}
          {% endfor %}
        </div>

        <div class="mt-3">
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-check-circle"></i>
            {% if project %}Update{% else %}Create{% endif %}
          </button>
          <a href="{% url 'project_list' %}" class="btn btn-secondary ms-2">
            <i class="bi bi-arrow-left-circle"></i> Cancel
          </a>
        </div>
      </form>

    </div>
  </div>
</div>
{% endblock %}
