{% extends "base/base.html" %}
{% block content %}
<div class="container mt-4">
  <h1 class="text-center mb-4">Budget Requests</h1>
  {% if not read_only %}
  <a href="{% url 'finance:submit_budget_request' %}" class="btn btn-primary mb-3">Submit Budget Request</a>
  {% endif %}
  <div class="card shadow-sm">
    <!-- Nav tabs -->
    <ul class="nav nav-tabs" id="budgetRequestTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button">
          Pending <span class="badge bg-warning text-dark">{{ pending_count }}</span>
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="approved-tab" data-bs-toggle="tab" data-bs-target="#approved" type="button">
          Approved <span class="badge bg-success">{{ approved_count }}</span>
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="declined-tab" data-bs-toggle="tab" data-bs-target="#declined" type="button">
          Declined <span class="badge bg-danger">{{ declined_count }}</span>
        </button>
      </li>
    </ul>

    <!-- Tab content -->
    <div class="tab-content p-3">
      <!-- Pending Tab -->
      <div class="tab-pane fade show active" id="pending">
        <div class="table-responsive">
          <table class="table table-bordered table-hover">
            <thead class="thead-light">
              <tr>
                <th>Department</th>
                <th>Amount Requested</th>
                <th>Status</th>
                <th>Date Requested</th>
                {% if not read_only %}
                <th>Actions</th>
                {% endif %}
              </tr>
            </thead>
            <tbody>
              {% for request in pending_requests %}
              <tr onclick="window.location='{% url 'finance:budget_request_detail' request.id %}'" style="cursor:pointer;">
                <td>{{ request.department }}</td>
                <td>R {{ request.amount_requested }}</td>
                <td>{{ request.status }}</td>
                <td>{{ request.date_requested }}</td>
                {% if not read_only %}
                <td>
                  <a href="{% url 'finance:approve_budget_request' request.id %}" class="btn btn-sm btn-success">Approve</a>
                  <a href="{% url 'finance:reject_budget_request' request.id %}" class="btn btn-sm btn-danger">Reject</a>
                </td>
                {% endif %}
              </tr>
              {% empty %}
              <tr>
                <td colspan="{% if not read_only %}5{% else %}4{% endif %}" class="text-center text-muted">No pending budget requests found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Approved Tab -->
      <div class="tab-pane fade" id="approved">
        <div class="table-responsive">
          <table class="table table-bordered table-hover">
            <thead class="thead-light">
              <tr>
                <th>Department</th>
                <th>Amount Requested</th>
                <th>Status</th>
                <th>Date Requested</th>
                <th>Date Processed</th>
              </tr>
            </thead>
            <tbody>
              {% for request in approved_requests %}
              <tr onclick="window.location='{% url 'finance:budget_request_detail' request.id %}'" style="cursor:pointer;">
                <td>{{ request.department }}</td>
                <td>R {{ request.amount_requested }}</td>
                <td>{{ request.status }}</td>
                <td>{{ request.date_requested }}</td>
                <td>{{ request.date_processed }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="text-center text-muted">No approved budget requests found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Declined Tab -->
      <div class="tab-pane fade" id="declined">
        <div class="table-responsive">
          <table class="table table-bordered table-hover">
            <thead class="thead-light">
              <tr>
                <th>Department</th>
                <th>Amount Requested</th>
                <th>Status</th>
                <th>Date Requested</th>
                <th>Date Processed</th>
              </tr>
            </thead>
            <tbody>
              {% for request in declined_requests %}
              <tr onclick="window.location='{% url 'finance:budget_request_detail' request.id %}'" style="cursor:pointer;">
                <td>{{ request.department }}</td>
                <td>R {{ request.amount_requested }}</td>
                <td>{{ request.status }}</td>
                <td>{{ request.date_requested }}</td>
                <td>{{ request.date_processed }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="text-center text-muted">No declined budget requests found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
